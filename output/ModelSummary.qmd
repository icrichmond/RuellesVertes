---
title: "Model Summary & Update"
format: 
  html:
    self-contained: true
knitr:
  opts_knit:
    root.dir: "C:/Users/I_RICHMO/Documents/Repositories/ruelles-vertes"
---

```{r, echo = F, eval = T, message = F, warning = F}
source('R/packages.R')

```

# New Model Structure

## Hypothesis-Based

Most of the changes to the model approach is based on the desire to make our work more rooted in hypotheses, which I think makes it more easier to interpret. In addition, due to our low sample size (n = 24), splitting models into groups of explanatory variables reduces the risk of overfitting.

### Explanatory Variables

+-------------------------+---------------------------+--------------------+
| Group                   | Variable                  | Unit               |
+=========================+===========================+====================+
| Vegetation Within Alley | Canopy cover              | \%                 |
+-------------------------+---------------------------+--------------------+
|                         | Midstorey cover           | \%                 |
+-------------------------+---------------------------+--------------------+
|                         | Ground cover              | \%                 |
+-------------------------+---------------------------+--------------------+
| Alley Structure         | Alley length              | metres             |
+-------------------------+---------------------------+--------------------+
|                         | Alley area                | metres^2^          |
+-------------------------+---------------------------+--------------------+
| Aesthetic Features 1    | Public art                | common/rare/absent |
+-------------------------+---------------------------+--------------------+
|                         | Children's play equipment | common/rare/absent |
+-------------------------+---------------------------+--------------------+
|                         | Maintained structures     | common/rare/absent |
+-------------------------+---------------------------+--------------------+
| Aesthetic Features 2    | Wildlife support          | common/rare/absent |
+-------------------------+---------------------------+--------------------+
|                         | Maintained gardens        | common/rare/absent |
+-------------------------+---------------------------+--------------------+
| Surrounding Land Cover  | Canopy cover              | \%                 |
|                         |                           |                    |
| (50 m & 100 m)          |                           |                    |
+-------------------------+---------------------------+--------------------+
|                         | Vegetation cover          | \%                 |
+-------------------------+---------------------------+--------------------+
|                         | Building cover            | \%                 |
+-------------------------+---------------------------+--------------------+
|                         | Impervious cover          | \%                 |
+-------------------------+---------------------------+--------------------+
|                         | Road area                 | metres^2^          |
+-------------------------+---------------------------+--------------------+

### Models

Temperature:

$$
Temp \sim Vegetation \ within \ alleys \ + \ Alley \ structure
$$ $$
Temp \sim Surrounding \ land \ cover \ 50m
$$ $$
Temp \sim Surrounding \ land \ cover \ 100m
$$

Noise:

$$
Noise \sim Vegetation \ within \ alleys \ + \ Alley \ structure
$$

$$
Noise \sim Aesthetic \ features  \ 1
$$

$$
Noise \sim Aesthetics \ features \ 2
$$\

$$
Noise \sim Surrounding \ land \ cover \ 50m
$$ $$
Noise \sim Surrounding \ land \ cover \ 100m
$$

Habitat Provisioning:

$$ Habitat \sim Vegetation \ within \ alleys \ + \ Alley \ structure $$

$$ Habitat \sim Aesthetic \ features  \ 2 $$

Food Provisioning:

$$ Food \sim Vegetation \ within \ alleys \ + \ Alley \ structure $$

$$ Food \sim Aesthetic \ features  \ 1 $$

$$ Food \sim Aesthetics \ features \ 2 $$

# Model Outputs

## Temperature

```{r, echo = F, eval = T}
tar_load(model_max_temp)

tbl_regression(model_max_temp[[1]]$veg_Avg_max_daily_temp,
               label = list(Groundcover_avg = "Ground Cover (%)", 
                            Midstorey_avg = "Midstory Cover (%)",
                            Canopy_avg = "Canopy Cover (%)",
                            Ruelle_length_m = "Ruelle Length (m)",
                            Ruelle_area_m2 = "Ruelle Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 1a. Average maximum temperature explained by vegetation within the ruelle and ruelle structure")

tbl_regression(model_max_temp[[2]]$Avg_max_daily_temp_50,
               label = list(perimpgr = "Impervious Cover (%)", 
                            perveggr = "Vegetation Cover (%)",
                            perbuild = "Building Cover (%)",
                            percan = "Canopy Cover (%)",
                            road_area_m2 = "Road Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 1b. Average maximum temperature explained by surrounding landcover variables within a 50 m buffer surrounding the sensor")

tbl_regression(model_max_temp[[2]]$Avg_max_daily_temp_100,
               label = list(perimpgr = "Impervious Cover (%)", 
                            perveggr = "Vegetation Cover (%)",
                            perbuild = "Building Cover (%)",
                            percan = "Canopy Cover (%)",
                            road_area_m2 = "Road Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 1c. Average maximum temperature explained by surrounding landcover variables within a 100 m buffer surrounding the sensor")

tar_load(model_min_temp)

tbl_regression(model_min_temp[[1]]$veg_Avg_min_daily_temp,
               label = list(Groundcover_avg = "Ground Cover (%)", 
                            Midstorey_avg = "Midstory Cover (%)",
                            Canopy_avg = "Canopy Cover (%)",
                            Ruelle_length_m = "Ruelle Length (m)",
                            Ruelle_area_m2 = "Ruelle Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 1d. Average minimum temperature explained by vegetation within the ruelle and ruelle structure")

tbl_regression(model_min_temp[[2]]$Avg_min_daily_temp_50,
               label = list(perimpgr = "Impervious Cover (%)", 
                            perveggr = "Vegetation Cover (%)",
                            perbuild = "Building Cover (%)",
                            percan = "Canopy Cover (%)",
                            road_area_m2 = "Road Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 1e. Average minimum temperature explained by surrounding landcover variables within a 50 m buffer surrounding the sensor")

tbl_regression(model_min_temp[[2]]$Avg_min_daily_temp_100,
               label = list(perimpgr = "Impervious Cover (%)", 
                            perveggr = "Vegetation Cover (%)",
                            perbuild = "Building Cover (%)",
                            percan = "Canopy Cover (%)",
                            road_area_m2 = "Road Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 1f. Average minimum temperature explained by surrounding landcover variables within a 100 m buffer surrounding the sensor")


```

## Noise

```{r, echo = F, eval = T}
tar_load(model_noise)

tbl_regression(model_noise[[1]]$veg_mean_NDSI,
               label = list(Groundcover_avg = "Ground Cover (%)", 
                            Midstorey_avg = "Midstory Cover (%)",
                            Canopy_avg = "Canopy Cover (%)",
                            Ruelle_length_m = "Ruelle Length (m)",
                            Ruelle_area_m2 = "Ruelle Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 2a. Noise explained by vegetation within the ruelle and ruelle structure")

tbl_regression(model_noise[[1]]$aes1_mean_NDSI,
               label = list(PublicArt = "Public Art", 
                            PlayEquipment = "Play Equipment",
                            StructureCondition = "Maintained Structures"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 2b. Noise explained by aesthetic features in group 1")

tbl_regression(model_noise[[1]]$aes2_mean_NDSI,
               label = list(WildlifeSupport = "Wildlife Support", 
                            MaintainedGardens = "Maintained Gardens"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 2c. Noise explained by aesthetic features in group 2")

tbl_regression(model_noise[[2]]$mean_NDSI_50,
               label = list(perimpgr = "Impervious Cover (%)", 
                            perveggr = "Vegetation Cover (%)",
                            perbuild = "Building Cover (%)",
                            percan = "Canopy Cover (%)",
                            road_area_m2 = "Road Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 2d. Noise explained by surrounding landcover variables within a 50 m buffer surrounding the sensor")

tbl_regression(model_noise[[2]]$mean_NDSI_100,
               label = list(perimpgr = "Impervious Cover (%)", 
                            perveggr = "Vegetation Cover (%)",
                            perbuild = "Building Cover (%)",
                            percan = "Canopy Cover (%)",
                            road_area_m2 = "Road Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 2e. Boise explained by surrounding landcover variables within a 100 m buffer surrounding the sensor")
```

## Floral Habitat

```{r, echo = F, eval = T}
tar_load(model_habitat)

tbl_regression(model_habitat[[1]]$veg_Floral_coverage_per_m2,
               label = list(Groundcover_avg = "Ground Cover (%)", 
                            Midstorey_avg = "Midstory Cover (%)",
                            Canopy_avg = "Canopy Cover (%)",
                            Ruelle_length_m = "Ruelle Length (m)",
                            Ruelle_area_m2 = "Ruelle Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 3a. Floral habitat explained by vegetation within the ruelle and ruelle structure")


tbl_regression(model_habitat[[1]]$aes2_Floral_coverage_per_m2,
               label = list(WildlifeSupport = "Wildlife Support", 
                            MaintainedGardens = "Maintained Gardens"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 3b. Floral habitat explained by aesthetic features in group 2")

```

## Food

```{r, echo = F, eval = T}
tar_load(model_food)

tbl_regression(model_food[[1]]$veg_Food_coverage_per_m2,
               label = list(Groundcover_avg = "Ground Cover (%)", 
                            Midstorey_avg = "Midstory Cover (%)",
                            Canopy_avg = "Canopy Cover (%)",
                            Ruelle_length_m = "Ruelle Length (m)",
                            Ruelle_area_m2 = "Ruelle Area (m2)"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 4a. Food provision explained by vegetation within the ruelle and ruelle structure")

tbl_regression(model_food[[1]]$aes1_Food_coverage_per_m2,
               label = list(PublicArt = "Public Art", 
                            PlayEquipment = "Play Equipment",
                            StructureCondition = "Maintained Structures"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 4b. Food provision explained by aesthetic features in group 1")

tbl_regression(model_food[[1]]$aes2_Food_coverage_per_m2,
               label = list(WildlifeSupport = "Wildlife Support", 
                            MaintainedGardens = "Maintained Gardens"),
               intercept = T, estimate_fun = function(x) style_number(x, digits = 3)) %>% 
  as_gt() %>% 
  tab_header(title = "Table 4c. Food provision explained by aesthetic features in group 2")

```

# Figures

There are no significant relationships between food provisioning and temperature and any of the variables measured. Below we visualize just the models that contain significant relationships.

```{r, echo = F, eval = T}

dwplot(model_noise[[1]]$aes2_mean_NDSI) + 
  theme_classic() 

dwplot(model_noise[[2]]$mean_NDSI_50, dot_args = list(colour = "black")) + 
 # relabel_predictors(c(perimpgr = "Impervious Cover (%)", 
 #                           perveggr = "Vegetation Cover (%)",
 #                           perbuild = "Building Cover (%)",
 #                           percan = "Canopy Cover (%)",
 #                           road_area_m2 = "Road Area (m2)")) +
  theme_classic() + 
  theme(legend.position = "none") + 
  labs(x = "Estimate") 

dwplot(model_noise[[2]]$mean_NDSI_100)

dwplot(model_habitat[[1]]$veg_Floral_coverage_per_m2)
```
